
# Техническое задание (уровень senior)  
## Платформа взносов и учёта участников Азербайджанской диаспоры в Казахстане (Kaspi, 2000₸/мес)

**Версия:** 1.0  
**Дата:** 08.02.2026  
**Язык интерфейса (по умолчанию):** RU (опционально KZ позже)

---

## 1) Контекст и проблема
Сейчас оплата членских взносов организована через общий чат WhatsApp (~300 участников). Участники переводят деньги на счёт/карту Kaspi и отправляют чек в чат. Администратор вручную фиксирует, кто оплатил за месяц, и кто нет. Это:
- занимает много времени;
- повышает риск ошибок и конфликтов;
- не хранит историю платежей в одном месте;
- затрудняет контроль задолженности и отчётность.

---

## 2) Цель проекта
Создать веб-сервис (сайт/портал), который:
1) позволяет участнику **зарегистрироваться**, ввести свои данные и **оплатить членский взнос 2000₸** за выбранный месяц (или текущий месяц);
2) **автоматически фиксирует факт оплаты** (в идеале через интеграцию Kaspi, либо как минимум через модерацию админом на первом этапе);
3) хранит **историю платежей** участника за всё время;
4) предоставляет администратору **админ-панель** для управления участниками, статусами, платежами и отчётами;
5) сокращает ручной труд и убирает «чеки в чате».

---

## 3) Границы проекта (Scope)
### 3.1 MVP (первый релиз)
- Публичный сайт (информация + кнопка входа/регистрации).
- Регистрация/вход.
- Личный кабинет участника:
  - статус членства (активен/просрочен),
  - «Оплатить 2000₸»,
  - история платежей по месяцам.
- Админ-панель:
  - список участников + статусы,
  - список платежей,
  - **ручная отметка оплаты** (для старта), загрузка/ссылка на чек (опционально),
  - отчёт/экспорт (CSV).
- Бизнес-логика периодов (месяц оплаты, задолженность).

### 3.2 Следующая очередь (после MVP)
- Автоподтверждение платежей через интеграцию Kaspi (если возможно технически/юридически).
- Уведомления (WhatsApp/SMS/email) о задолженности/оплате.
- Мультиязычность (RU/KZ).
- Роли в админке (Админ / Кассир / Контент-менеджер).
- Членский QR-билет.

---

## 4) Роли и права
### 4.1 Гость
- просмотр публичных страниц;
- регистрация.

### 4.2 Участник
- просмотр и редактирование своего профиля;
- создание оплаты за месяц;
- просмотр истории платежей;
- скачивание квитанции/подтверждения (если реализовано).

### 4.3 Администратор
- управление участниками (статусы, правки, блокировка);
- управление платежами (подтверждение/отмена, ручные записи);
- выгрузка отчётов;
- управление контентом страниц (если включено в MVP).

---

## 5) Страницы сайта (предлагаемая структура)
### 5.1 Публичная часть
- `/` Главная (миссия + CTA: «Войти/Зарегистрироваться», «Оплатить взнос»)
- `/about` О диаспоре
- `/rules` Правила/условия членства (оферта)
- `/contacts` Контакты
- `/privacy` Политика конфиденциальности

### 5.2 Auth
- `/auth/register`
- `/auth/login`
- `/auth/forgot` (опционально)

### 5.3 Кабинет
- `/cabinet` (дашборд: статус, текущий месяц, кнопка «Оплатить 2000₸»)
- `/cabinet/payments` (история платежей)
- `/cabinet/profile` (профиль)

### 5.4 Админка
- `/admin/login`
- `/admin/members`
- `/admin/payments`
- `/admin/reports` (экспорт)
- `/admin/audit` (лог действий — желательно)

---

## 6) Данные (минимальная модель)
### 6.1 Участник (User)
Поля:
- `id`
- `full_name` (обязательно)
- `phone` (обязательно, уникально)
- `email` (опционально)
- `iin` (опционально, если нужно)
- `city` (опционально)
- `role`: `member|admin`
- `status`: `pending|active|overdue|suspended|blocked`
- `created_at`, `updated_at`

### 6.2 Платёж (Payment)
Поля:
- `id`
- `user_id`
- `period` (формат `YYYY-MM`, напр. `2026-01`)
- `amount` (фиксировано 2000)
- `currency` (KZT)
- `status`: `pending|confirmed|rejected|refunded`
- `method`: `kaspi_transfer|kaspi_qr|manual|other`
- `provider_payment_id` (если интеграция)
- `proof_url` (опционально: ссылка/файл чека)
- `confirmed_by` (admin id)
- `confirmed_at`
- `created_at`

### 6.3 Журнал действий (Audit Log) — желательно
- `actor_user_id`
- `action` (например `PAYMENT_CONFIRMED`, `MEMBER_STATUS_CHANGED`)
- `entity_type`, `entity_id`
- `before_json`, `after_json`
- `created_at`, `ip`, `user_agent`

---

## 7) Бизнес-правила
### 7.1 Стоимость
- Членский взнос: **2000₸ / месяц**.

### 7.2 Период оплаты
- Платёж всегда привязан к месяцу `YYYY-MM`.
- Участник может оплатить:
  - текущий месяц (по умолчанию),
  - (опционально) прошлый месяц,
  - (опционально) будущий месяц.

### 7.3 Статус «Активен»
- Участник считается **Active**, если есть **Confirmed** платеж за **текущий период** (или за период, который вы определите правилами).

### 7.4 Просрочка
- Участник считается **Overdue**, если отсутствует подтверждённый платёж за текущий период.
- Дедлайн оплаты: **зафиксировать в настройках** (например, до 10 числа текущего месяца).

---

## 8) Потоки (User Journeys)
### 8.1 Участник: регистрация → оплата → история
1) Открывает сайт → «Регистрация».
2) Вводит ФИО + телефон (и доп. поля).
3) Заходит в кабинет → видит «Оплатить 2000₸ за текущий месяц».
4) Нажимает «Оплатить»:
   - **MVP:** создаётся запись `Payment(status=pending)` и показывается инструкция оплаты (Kaspi) + загрузка чека (опционально).
   - **Далее:** переходит на оплату, после webhook статус становится `confirmed`.
5) После подтверждения видит «Оплачено за месяц».
6) В истории платежей отображаются все месяцы.

### 8.2 Администратор: подтверждение оплаты (MVP)
1) Заходит в `/admin/payments`.
2) Видит список pending-платежей (фильтр по месяцу).
3) Открывает платёж → проверяет доказательство (если есть).
4) Нажимает «Подтвердить» → платёж становится `confirmed`, участник `active`.

---

## 9) Интеграция Kaspi (важная ремарка)
**Практичный подход:**
- В MVP делаем **ручную модерацию** оплат (быстро, без риска упереться в ограничения Kaspi).
- Параллельно выясняем, доступен ли у Kaspi подходящий шлюз/API для онлайн-оплаты с подтверждением.
- Если API доступен: внедряем `payment_intent` + `webhook`.

---

## 10) Админка и редактирование данных
В админке:
- правки профиля участника (исправление ФИО/телефона);
- фильтры: «не оплатили за месяц»;
- экспорт CSV: `ФИО, телефон, период, статус, дата подтверждения`.

Контент-страницы можно хранить в БД (таблица `pages`) и редактировать через WYSIWYG (опционально).

---

## 11) Безопасность
- HTTPS (на проде обязательно).
- Пароли: bcrypt/argon2.
- Rate limiting на login/register.
- Роли и авторизация на уровне API.
- Логи действий админов.
- Секреты только в `.env`, в git не коммить.

---

## 12) Нефункциональные требования
- Мобильная адаптация: обязательно.
- Локальный запуск: через Docker Compose (без Denwer/XAMPP).
- Резервное копирование БД: ежедневно.

---

## 13) Критерии приёмки MVP
- Участник может зарегистрироваться/войти.
- В кабинете отображается месяц и статус оплаты.
- Можно создать платеж за месяц (pending).
- Админ видит pending платежи и подтверждает их.
- История платежей сохраняется.
- Есть экспорт в CSV.
